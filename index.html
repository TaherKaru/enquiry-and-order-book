<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Goodluck Stores</title>
<style>
body {
  font-family: 'Segoe UI', Tahoma, sans-serif;
  margin: 0;
  background: linear-gradient(135deg,#f0f4f8,#d9eaf7);
  padding: 20px;
}
.header {
  display:flex; align-items:center; justify-content:center;
  background:#00796B; color:white; padding:15px; border-radius:12px;
  box-shadow:0 6px 20px rgba(0,0,0,0.2); margin-bottom:20px;
}
.header img { width:70px; height:70px; margin-right:15px; border-radius:50%; border:2px solid white; }
.header-text { text-align:center; }
.header-text h1 { margin:0; font-size:32px; }
.header-text h3 { margin:0; font-size:16px; font-weight:normal; }
#dashboard {display:flex; flex-wrap:wrap; gap:15px; justify-content:center; margin-bottom:20px;}
.dashboard-card{background:white;padding:15px;border-radius:12px;min-width:150px;text-align:center;box-shadow:0 4px 12px rgba(0,0,0,0.1);}
form {
  background: #fff;
  padding: 25px;
  border-radius: 15px;
  margin-bottom: 30px;
  box-shadow:0 6px 18px rgba(0,0,0,0.15);
}
form label { display:block; margin-top:12px; font-weight:bold; color:#333; }
input, textarea, select { width:100%; padding:10px; margin-top:6px; border:1px solid #ccc; border-radius:8px; font-size:14px; transition:0.3s;}
input:focus,textarea:focus,select:focus{outline:none; border-color:#007BFF; box-shadow:0 0 6px rgba(0,123,255,0.3);}
button{margin-top:15px;padding:10px 16px;border:none;border-radius:8px;background:#007BFF;color:white;font-weight:bold;cursor:pointer;transition:0.3s;}
button:hover{background:#0056b3;}
.export-btn{background:#4CAF50;} .export-btn:hover{background:#2e7d32;}
.record-btn{background:#00796B;} .record-btn:hover{background:#004d40;}
.action-btn{margin:2px;font-size:12px;padding:5px 8px;border-radius:6px;border:none;cursor:pointer;}
.edit-btn{background:#ff9800;color:white;} .edit-btn:hover{background:#e65100;}
.delete-btn{background:#d32f2f;color:white;} .delete-btn:hover{background:#9a0007;}
.whatsapp-btn{background:#25D366;color:white;} .whatsapp-btn:hover{background:#128C7E;}
.call-btn{background:#0288D1;color:white;} .call-btn:hover{background:#01579B;}
.email-btn{background:#D32F2F;color:white;} .email-btn:hover{background:#9a0007;}
.search-box{margin-top:15px;padding:10px;width:100%;border-radius:8px;border:1px solid #888;font-size:14px;}
.modal{display:none;position:fixed;z-index:999;left:0;top:0;width:100%;height:100%;overflow:auto;background:rgba(0,0,0,0.5);}
.modal-content{background:#fff;margin:5% auto;padding:20px;width:95%;max-width:950px;border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,0.25);}
.close-btn{float:right;font-size:22px;font-weight:bold;color:#d32f2f;cursor:pointer;}
.record-card{background:#f9f9f9;border-radius:12px;padding:15px;margin:10px 0;box-shadow:0 4px 12px rgba(0,0,0,0.1);}
.card-header{font-weight:bold;color:#007BFF;margin-bottom:8px;display:inline-block;width:120px;}
.card-buttons{
  margin-top:8px;
  display:flex;
  flex-wrap:wrap; /* allows buttons to wrap on small screens */
}
.card-buttons button{
  margin-right:6px; /* space between buttons */
  margin-bottom:4px; /* vertical spacing when wrapped */
}
.toast {position:fixed;bottom:20px;right:20px;background:#333;color:white;padding:12px 18px;border-radius:8px;opacity:0.9;z-index:1000;display:none;}
.logout-btn{background:#d63031;color:white;padding:8px 15px;border:none;border-radius:8px;cursor:pointer;}
</style>
</head>
<body>
<script>
const currentUser = localStorage.getItem("loggedInUser");
if(!currentUser) window.location.href="login.html";
function logout(){ localStorage.removeItem("loggedInUser"); window.location.href="login.html"; }
let enquiries=JSON.parse(localStorage.getItem("enquiries_"+currentUser))||[];
let orders=JSON.parse(localStorage.getItem("orders_"+currentUser))||[];
let currentModalKey="";
</script>

<div class="header">
  <img src="https://cdn-icons-png.flaticon.com/512/263/263142.png" alt="Store Logo">
  <div class="header-text">
    <h1>Goodluck Stores</h1>
    <h3>Shop No: 8, Tardeo, Mumbai-400034 | Contact: 8169258675</h3>
  </div>
</div>

<!-- Dashboard -->
<div id="dashboard">
  <div class="dashboard-card"><h3>Total Enquiries</h3><p id="totalEnq">0</p></div>
  <div class="dashboard-card"><h3>Pending</h3><p id="pendingEnq">0</p></div>
  <div class="dashboard-card"><h3>Completed</h3><p id="completedEnq">0</p></div>
  <div class="dashboard-card"><h3>Total Orders</h3><p id="totalOrders">0</p></div>
</div>

<div style="display:flex; justify-content:space-between; align-items:center; margin:20px 0;">
  <h2>Enquiry Book</h2>
  <button class="logout-btn" onclick="logout()">Logout</button>
</div>

<!-- Enquiry Form -->
<form id="enquiryForm">
<label>Enquiry No</label><input type="text" id="enqNo">
<label>Enquiry Date</label><input type="date" id="enqDate" required>
<label>Customer Name</label><input type="text" id="enqName" required>
<label>Phone Number</label><input type="text" id="enqPhone" required>
<label>Email</label><input type="email" id="enqEmail">
<label>Enquiry Details</label><textarea id="enqDetails" required></textarea>
<label>Remarks</label><textarea id="enqRemarks"></textarea>
<label>Tags</label>
<input type="text" id="enqTags" placeholder="VIP, Follow-up etc">
<select id="enqTagDropdown" onchange="if(this.value){ document.getElementById('enqTags').value = this.value; }">
  <option value="">-- Select Service --</option>
  <option value="Glass items">Glass items</option>
  <option value="Glass Cutting">Glass Cutting</option>
  <option value="Rubber Stamp">Rubber Stamp</option>
  <option value="Nameplate">Nameplate</option>
  <option value="Photoframe">Photoframe</option>
  <option value="Frame Glass/Repairing">Frame Glass/Repairing</option>
  <option value="Miscellaneous">Miscellaneous</option>
</select>
<label>Status</label>
<select id="enqStatus">
<option value="Pending">Pending</option>
<option value="In Progress">In Progress</option>
<option value="Completed">Completed</option>
</select>
<button type="submit">Save Enquiry</button>
<button type="button" class="export-btn" onclick="exportData('enquiries')">Export Enquiries</button>
<button type="button" class="record-btn" onclick="openModal('enquiries')">View Records</button>
</form>

<!-- Order Form -->
<h2>Order Book</h2>
<form id="orderForm">
<label>Customer Name</label><input type="text" id="ordName" required>
<label>Phone Number</label><input type="text" id="ordPhone" required>
<label>Email</label><input type="email" id="ordEmail">
<label>Order Details</label><textarea id="ordDetails" required></textarea>
<label>Tags</label>
<input type="text" id="ordTags" placeholder="VIP, Custom etc">
<select id="ordTagDropdown" onchange="if(this.value){ document.getElementById('ordTags').value = this.value; }">
  <option value="">-- Select Service --</option>
  <option value="Glass items">Glass items</option>
  <option value="Glass Cutting">Glass Cutting</option>
  <option value="Rubber Stamp">Rubber Stamp</option>
  <option value="Nameplate">Nameplate</option>
  <option value="Photoframe">Photoframe</option>
  <option value="Frame Glass/Repairing">Frame Glass/Repairing</option>
  <option value="Miscellaneous">Miscellaneous</option>
</select>
<label>Status</label>
<select id="ordStatus">
<option value="Pending">Pending</option>
<option value="In Progress">In Progress</option>
<option value="Completed">Completed</option>
</select>
<button type="submit">Save Order</button>
<button type="button" class="export-btn" onclick="exportData('orders')">Export Orders</button>
<button type="button" class="record-btn" onclick="openModal('orders')">View Records</button>
<!-- Auto Fill Button -->
<button type="button" class="record-btn" onclick="openAutoFillModal()">Auto Fill from Enquiry</button>
</form>

<!-- Main Modal -->
<div id="recordModal" class="modal">
<div class="modal-content">
<span class="close-btn" onclick="closeModal()">&times;</span>
<h3 id="modalTitle">Records</h3>
<input type="text" id="modalSearch" class="search-box modal-search" placeholder="Search records..." onkeyup="filterRecords()">
<div id="modalBody"></div>
<button onclick="printRecords()">Print Records</button>
</div>
</div>

<!-- Auto Fill Modal -->
<div id="autoFillModal" class="modal">
<div class="modal-content">
<span class="close-btn" onclick="closeAutoFillModal()">&times;</span>
<h3>Choose Enquiry to Auto Fill</h3>
<input type="text" id="autoFillSearch" class="search-box" placeholder="Search enquiries..." onkeyup="filterAutoFillRecords()">
<div id="autoFillBody"></div>
</div>
</div>

<div class="toast" id="toast"></div>

<script>
// Toast + Storage
function toast(msg){ const t=document.getElementById("toast"); t.textContent=msg; t.style.display="block"; setTimeout(()=>t.style.display="none",3000);}
function saveLocal(){ localStorage.setItem("enquiries_"+currentUser,JSON.stringify(enquiries)); localStorage.setItem("orders_"+currentUser,JSON.stringify(orders)); updateDashboard(); }
function generateEnquiryNo(){ let c=localStorage.getItem("enquiryCounter_"+currentUser)||1; document.getElementById("enqNo").value=c; }
function setTodayDate(){ document.getElementById("enqDate").value=new Date().toISOString().split('T')[0]; }

// Dashboard update
function updateDashboard(){
  document.getElementById("totalEnq").textContent=enquiries.length;
  document.getElementById("pendingEnq").textContent=enquiries.filter(e=>e.status==="Pending").length;
  document.getElementById("completedEnq").textContent=enquiries.filter(e=>e.status==="Completed").length;
  document.getElementById("totalOrders").textContent=orders.length;
}

// Save Enquiry
document.getElementById("enquiryForm").addEventListener("submit",e=>{
e.preventDefault();
let enqNo=document.getElementById("enqNo").value;
let counter=parseInt(localStorage.getItem("enquiryCounter_"+currentUser)||1);
localStorage.setItem("enquiryCounter_"+currentUser,counter+1);
let entry={enqNo,enqDate:enqDate.value,name:enqName.value,phone:enqPhone.value,email:enqEmail.value,
details:enqDetails.value,remarks:enqRemarks.value,tags:enqTags.value,status:enqStatus.value};
enquiries.push(entry); saveLocal();
e.target.reset(); generateEnquiryNo(); setTodayDate(); toast("Enquiry Saved!");
});

// Save Order
document.getElementById("orderForm").addEventListener("submit",e=>{
e.preventDefault();
let entry={name:ordName.value,phone:ordPhone.value,email:ordEmail.value,details:ordDetails.value,tags:ordTags.value,status:ordStatus.value};
orders.push(entry); saveLocal(); e.target.reset(); toast("Order Saved!");
});

// Export CSV
function exportData(key){ let data=(key==="enquiries")?enquiries:orders; if(!data.length){alert("No data!");return;}
let csv=(key==="enquiries")?"EnqNo,Date,Name,Phone,Email,Details,Remarks,Tags,Status\n"+data.map(r=>`${r.enqNo},${r.enqDate},${r.name},${r.phone},${r.email},${r.details},${r.remarks},${r.tags},${r.status}`).join("\n")
:"Name,Phone,Email,Details,Tags,Status\n"+data.map(r=>`${r.name},${r.phone},${r.email},${r.details},${r.tags},${r.status}`).join("\n");
let blob=new Blob([csv],{type:"text/csv"}),a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download=key+"_data.csv"; a.click(); }

// Modal + Records
function openModal(key){currentModalKey=key; document.getElementById("recordModal").style.display="block"; document.getElementById("modalTitle").textContent=(key==="enquiries")?"Enquiry Records":"Order Records"; renderRecords();}
function closeModal(){document.getElementById("recordModal").style.display="none";}
function renderRecords(){ let data=(currentModalKey==="enquiries")?enquiries:orders,body=document.getElementById("modalBody"); body.innerHTML="";
if(!data.length){body.innerHTML="<p>No records!</p>";return;}
data.forEach((r,i)=>{let card=document.createElement("div");card.className="record-card";
let html=""; for(let k in r) html+=`<div><span class="card-header">${k.toUpperCase()}:</span> ${r[k]}</div>`;
html+=`<div class="card-buttons"><button class="edit-btn" onclick="editRecord(${i})">Edit</button><button class="delete-btn" onclick="deleteRecord(${i})">Delete</button>`;
if(r.email) html+=`<button class="email-btn" onclick="openEmail('${r.email}','${r.name}')">Email</button>`;
html+=`<button class="whatsapp-btn" onclick="openWhatsApp('${r.phone}','${r.name}')">WhatsApp</button>`;
if(currentModalKey==="orders") html+=`<button class="call-btn" onclick="window.location.href='tel:${r.phone}'">Call</button>`;
html+=`</div>`; card.innerHTML=html; body.appendChild(card); });}
function filterRecords(){ let q=document.getElementById("modalSearch").value.toLowerCase(); document.querySelectorAll("#modalBody .record-card").forEach(c=>{c.style.display=c.innerText.toLowerCase().includes(q)?"block":"none";});}
function editRecord(i){ let r=(currentModalKey==="enquiries")?enquiries[i]:orders[i]; if(currentModalKey==="enquiries"){enqNo.value=r.enqNo;enqDate.value=r.enqDate;enqName.value=r.name;enqPhone.value=r.phone;enqEmail.value=r.email;enqDetails.value=r.details;enqRemarks.value=r.remarks;enqTags.value=r.tags;enqStatus.value=r.status; enquiries.splice(i,1);} else {ordName.value=r.name;ordPhone.value=r.phone;ordEmail.value=r.email;ordDetails.value=r.details;ordTags.value=r.tags;ordStatus.value=r.status; orders.splice(i,1);} saveLocal(); renderRecords(); closeModal(); toast("Record Loaded!");}
function deleteRecord(i){ if(currentModalKey==="enquiries"){enquiries.splice(i,1); toast("Enquiry Deleted!");} else {orders.splice(i,1); toast("Order Deleted!");} saveLocal(); renderRecords();}
function openWhatsApp(phone,name){ const msg=`Dear ${name},\n\nThank you for your enquiry.\n\nOur team shall get back to you shortly.\n\nRegards\nMustafa Karu\nProprietor\nGoodluck Stores`; window.open(`https://wa.me/${phone}?text=${encodeURIComponent(msg)}`,"_blank");}
function openEmail(email,name){ const msg=`Dear ${name},\n\nThank you for your enquiry.\n\nOur team shall get back to you soon.\n\nRegards\nMustafa Karu\nProprietor\nGoodluck Stores`; window.location.href=`mailto:${email}?subject=Enquiry&body=${encodeURIComponent(msg)}`; }
function printRecords(){ let div=document.getElementById("modalBody").innerHTML; let w=window.open(); w.document.write('<html><head><title>Records</title></head><body>'+div+'</body></html>'); w.print(); w.close(); }

// Auto Fill Modal Functions
function openAutoFillModal(){
    document.getElementById("autoFillModal").style.display="block";
    renderAutoFillRecords();
}
function closeAutoFillModal(){ document.getElementById("autoFillModal").style.display="none"; }
function renderAutoFillRecords(){
    const body = document.getElementById("autoFillBody");
    body.innerHTML = "";
    if(!enquiries.length){ body.innerHTML="<p>No enquiries!</p>"; return; }
    enquiries.forEach((r,i)=>{
        let card = document.createElement("div");
        card.className = "record-card";
        card.style.cursor = "pointer";
        card.onclick = ()=>{ fillOrderFromEnquiry(r); closeAutoFillModal(); toast("Order form auto-filled!"); };
        card.innerHTML = `<div><span class="card-header">Enquiry No:</span> ${r.enqNo}</div>
                          <div><span class="card-header">Name:</span> ${r.name}</div>
                          <div><span class="card-header">Phone:</span> ${r.phone}</div>
                          <div><span class="card-header">Email:</span> ${r.email}</div>
                          <div><span class="card-header">Tags:</span> ${r.tags}</div>
                          <div><span class="card-header">Details:</span> ${r.details}</div>`;
        body.appendChild(card);
    });
}
function filterAutoFillRecords(){
    const q = document.getElementById("autoFillSearch").value.toLowerCase();
    document.querySelectorAll("#autoFillBody .record-card").forEach(c=>{
        c.style.display = c.innerText.toLowerCase().includes(q) ? "block" : "none";
    });
}
function fillOrderFromEnquiry(enq){
    ordName.value = enq.name;
    ordPhone.value = enq.phone;
    ordEmail.value = enq.email;
    ordDetails.value = enq.details;
    ordTags.value = enq.tags;
    ordStatus.value = "Pending";
}

// Close modals on outside click
window.onclick = e => { 
    if (e.target == document.getElementById("recordModal")) { closeModal(); }
    if (e.target == document.getElementById("autoFillModal")) { closeAutoFillModal(); }
};

// Initialize Page
window.onload = () => { generateEnquiryNo(); setTodayDate(); updateDashboard(); };
</script>

</body>
</html>

